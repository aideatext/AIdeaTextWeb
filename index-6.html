<!doctype html>
<html lang="es" class="h-100">
    <head>

	<meta charset="UTF-8" />
	<title>AIdeaText</title>

    <meta name="Content-Type" />
    <meta name="viewport" content= "width=device-width, initial-scale=1" />
    <meta name="description" content= "AIdeaText
    AIdeaText is a project aimed at learning writing through the visualization of semantic maps." />
    <meta name="author" content= "ManuelVarZen" />
    <meta name="generator" content= "AIdeaText is a project aimed at learning writing through the visualization of semantic maps." />

	<!-- Twitter Card -->
	<meta name = "twitter:card" content = "summary_large_image" />
    <meta name = "twitter:site" content = "https://aideatext.ai" />
    <meta name = "twitter:creator" content = "@ManuelVarZen">
    <meta name = "twitter:title" content = "AIdeaText" />
    <meta name = "twitter:description" content = "AIdeaText is a project aimed at learning writing through the visualization of semantic maps." />
	<meta name = "twitter:image" content = "https://aideatext.ai/img/AIdeaTextCard.jpg"/>

    <!-- Open Graph -->
    <meta property="og:title" content = "AIdeaText" />
	<meta property="og:type" content = "website" />
	<meta property="og:url" content = "https://aideatext.ai" />
    <meta property="og:image" content = "https://aideatext.ai/img/AIdeaTextCard.jpg" />
	<meta property="og:image:secure_url" content = "https://aideatext.ai/img/AIdeaTextCard.jpg" />
	<meta property="og:description" content = "AIdeaText is a project aimed at learning writing through the visualization of semantic maps." />
	<meta property="og:image:alt" content="AIdeaText screenshot." />

    <!-- Aquí puedes agregar tus estilos CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <link rel="icon" type="image/png" href="favicon.png">

<script src="https://d3js.org/d3.v6.min.js"></script>
	    

  </head>

  <body>
    <div class="upper-section">
        <h1>AIdeaText - Web</h1>
    </div>


    <div class="container">
      <!-- <div class="section-title">Analyze</div> -->
         <div class="left-section">
          <!-- <div class="section-title">Input Text</div> -->
            <!-- Área de texto y botón Procesar -->
            <div class="text-input-section"><textarea id="text" name="text" placeholder=" Read: If you have downloaded and selected all
                3 files then you can enter your text here and press the Process Text button. In the section
                on the right you will see the graph of the semantic relationships of your text. For now
                it only works with texts in English but you can try with texts in Spanish.
                You can edit your text and press the Process Text button again to see how the semantic
                relationships of your text change."></textarea>
                <button type="button" id="procesarButton" onclick="processText()">[7] Procesar</button>
            </div>
        </div>
        <div class="right-section">
         <!-- <div class="section-titlle">Visualize graph</div> -->
            <div id="network"></div>
        </div>
    </div>

    <div class="lower-section">
        <p>AIdeaText is a project aimed at learning writing through the visualization of semantic maps. Contact: hello [at] aideatext [dot] ai</p>      </a></p>
        <footer>&copy; 2024 AIdeaText - AIdeaTextWeb - AIdeaText Analytics Services. All rights reserved </footer>
    </div>
	  
    <script type="text/javascript">
	function processText() {
  var textInput = document.getElementById("text").value;
  fetch('https://5f6b6akff7.execute-api.us-east-2.amazonaws.com/DEV/callmodel', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ text: textInput }),
  })
  .then(response => response.json())
  .then(data => {
    // Asumiendo que data ya es el objeto JSON como se describió anteriormente
    visualizeGraph(data); // Llama a una nueva función para visualizar el grafo
  })
  .catch(error => console.error('Error al llamar a la API:', error));
}

function visualizeGraph(data) {
  d3.select("#network").html("");
  const width = 800;
  const height = 400;
  
 const svg = d3.select("#network").append("svg")
      .attr("width", width)
      .attr("height", height);
  
  // Crear los nodos
  const nodes = data.nodes.map(d => ({...d, id: d.id}));
  
  // Crear los enlaces
  const links = data.edges.map(d => ({source: d.source, target: d.target, label: d.relation}));
  
  // Simulación de fuerzas para posicionar nodos y enlaces
  const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id))
      .force("charge", d3.forceManyBody())
      .force("center", d3.forceCenter(width / 2, height / 2));

  // Dibujar enlaces
  const link = svg.append("g")
      .attr("stroke", "#999")
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("stroke-width", d => Math.sqrt(d.value));

  // Dibujar nodos
  const node = svg.append("g")
      .attr("stroke", "#fff")
      .attr("stroke-width", 1.5)
      .selectAll("circle")
      .data(nodes)
      .join("circle")
      .attr("r", 5)
      .attr("fill", "#69b3a2")
      .call(drag(simulation));

  // Etiquetas de texto para los nodos
  const text = svg.append("g")
      .selectAll("text")
      .data(nodes)
      .join("text")
      .text(d => d.text)
      .attr("x", 8)
      .attr("y", "0.31em");

  // Actualizar la posición de nodos y enlaces en cada "tick" de la simulación
  simulation.on("tick", () => {
    link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

    text
        .attr("x", d => d.x)
        .attr("y", d => d.y);
  });

  // Función de arrastre para nodos
  function drag(simulation) {
    function dragstarted(event) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }

	function dragged(event) {
	    event.subject.fx = event.x;
	    event.subject.fy = event.y;
	}

	function dragended(event) {
	    if (!event.active) simulation.alphaTarget(0);
	    event.subject.fx = null;
	    event.subject.fy = null;
	}

    </script>
	  
  </body>
</html> 
