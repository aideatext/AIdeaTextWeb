<!doctype html>
<html lang="es" class="h-100">
<head>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>
<body>
<div id="semantic-network" style="width: 800px; height: 600px;"></div>

  <script src="graphUtils.js"></script>      

  <script>
    // Aquí pega la función ForceGraph
    function ForceGraph({
      nodes, // an iterable of node objects (typically [{id}, …])
      links // an iterable of link objects (typically [{source, target}, …])
    }, {
      nodeId = d => d.id, // given d in nodes, returns a unique identifier (string)
      nodeTitle, // given d in nodes, a title string
      nodeFill = "currentColor", // node stroke fill (if not using a group color encoding)
      nodeStroke = "#fff", // node stroke color
      nodeStrokeWidth = 1.5, // node stroke width, in pixels
      nodeStrokeOpacity = 1, // node stroke opacity
      nodeRadius = 5, // node radius, in pixels
      width = 800, // outer width, in pixels
      height = 600, // outer height, in pixels
    } = {}) {
      // Compute values.
      const N = nodes.map(nodeId);
      
      const svg = d3.create("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", [-width / 2, -height / 2, width, height])
          .attr("style", "max-width: 100%; height: auto; height: intrinsic;");

      const link = svg.append("g")
          .selectAll("line")
          .data(links)
          .join("line")
          .attr("stroke", "#999")
          .attr("stroke-opacity", 0.6)
          .attr("stroke-width", 1);

      const node = svg.append("g")
          .selectAll("circle")
          .data(nodes)
          .join("circle")
          .attr("r", nodeRadius)
          .attr("fill", nodeFill)
          .attr("stroke", nodeStroke)
          .attr("stroke-opacity", nodeStrokeOpacity)
          .attr("stroke-width", nodeStrokeWidth)
          .call(drag(simulation));

      if (nodeTitle) {
        node.append("title")
          .text(nodeTitle);
      }

      function ticked() {
        link
          .attr("x1", d => d.source.x)
          .attr("y1", d => d.source.y)
          .attr("x2", d => d.target.x)
          .attr("y2", d => d.target.y);

        node
          .attr("cx", d => d.x)
          .attr("cy", d => d.y);
      }

      function drag(simulation) {
        function dragstarted(event) {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          event.subject.fx = event.subject.x;
          event.subject.fy = event.subject.y;
        }
        
        function dragged(event) {
          event.subject.fx = event.x;
          event.subject.fy = event.y;
        }
        
        function dragended(event) {
          if (!event.active) simulation.alphaTarget(0);
          event.subject.fx = null;
          event.subject.fy = null;
        }
        
        return d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended);
      }

      return svg.node();
    }
  </script>

  <script>
    // Datos precargados de ejemplo
    const exampleData = {
      semantic_analysis: {
        nodes: [
          { id: "1", text: "Node 1" },
          { id: "2", text: "Node 2" },
          { id: "3", text: "Node 3" }
        ],
        edges: [
          { source: "1", target: "2", relation: "related" },
          { source: "2", target: "3", relation: "related" },
          { source: "3", target: "1", relation: "related" }
        ]
      }
    };

    // Contenedor para la red semántica
    const semanticNetworkContainer = document.getElementById("semantic-network");

    // Realizar la prueba con los datos precargados de ejemplo
    visualizeGraphData(exampleData, semanticNetworkContainer);
  </script>
</body>
</html>
